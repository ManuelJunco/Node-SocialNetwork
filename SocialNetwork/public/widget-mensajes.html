<div id="widget-mensajes">
	<button class="btn" onclick="cargarMensajes()">Actualizar</button>
	<table class="table table-hover">
		<thead>
			<tr>
				<th class="col-md-1"></th>
			</tr>
		</thead>
		<tbody id="tablaCuerpo">

		</tbody>
	</table>
	<div id="enviar-mensaje">
		<div class="form-group">
			<label class="control-label col-sm-2" for="enviar-mensaje">Mensaje:</label>
			<div class="col-sm-10">
				<input type="text" class="form-control" name="enviar-mensaje"
					placeholder="Nuevo mensaje" id="enviar-mensaje" />
			</div>
		</div>
		<div class="col-sm-offset-2 col-sm-10">
			<button type="button" class="btn btn-primary" id="boton-enviar"
				onclick="enviar()">Enviar</button>
		</div>
	</div>
</div>
<script>
	var mensajes;
	function cargarMensajes() {
		$.ajax({
			url : URLbase + "/mensaje/"+idAmigo"/"+ idAmigo,
			type : "GET",
			data : {},
			dataType : 'json',
			headers : {
				"token" : token
			},
			success : function(respuesta) {
				mensajes = respuesta;
				actualizarMensajes(mensajes);
			},
			error : function(error) {
				$("#contenedor-principal").load("widget-login.html");
			}
		});
	}

	function actualizarTabla(mensajes) {
		$("#tablaCuerpo").empty(); // Vaciar la tabla
		for (i = 0; i < mensajes.length; i++) {
			$("#tablaCuerpo").append(
					"<tr id='"+mensajes[i]._id+"'>" + "<td>"
							+ mensajes[i].texto + "</td>" + "</tr>");
		}
	}

	function enviar() {
		$.ajax({
			url : URLbase + "/mensaje",
			type : "POST",
			data : {
				receptor: $("#receptor").text(),
				texto : $("#enviar-mensaje").val()
			},
			dataType : 'json',
			headers : {
				"token" : token
			},
			success : function(respuesta) {
				console.log(respuesta); // <-- Prueba
				$("#contenedor-principal").load("widget-mensajes.html");

			},
			error : function(error) {
				$("#contenedor-principal").load("widget-login.html");
			}
		});
	}
	
	setInterval(function() {
		cargarMensajes();
	}, 1000);
	
	cargarMensajes();
</script>